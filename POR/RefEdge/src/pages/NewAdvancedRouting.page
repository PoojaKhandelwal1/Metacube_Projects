<!--
 * ReferenceEdge
 * 
 * Point of Reference, Inc. - Copyright 2014 All rights reserved.
 *
 * @company : Point of Reference, Inc.
 * @website : www.point-of-reference.com
 *
 * Disclaimer: THIS SOFTWARE IS PROVIDED "AS-IS" BY POINT OF REFERENCE ("POR"), 
 * WITH NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF THE SOFTWARE, 
 * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES 
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * POR SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY LICENSEE AS A RESULT OF USING, 
 * MODIFYING OR DISTRIBUTING THIS SOFTWARE OR ITS DERIVATIVES. POR IS NOT LIABLE FOR, 
 * AND MAKES NO REPRESENTATIONS OR WARRANTIES REGARDING, THE ACTIONS OR OMISSIONS OF 
 * ANY THIRD PARTIES (OR THE PRODUCTS OR SERVICES OFFERED BY ANY THIRD PARTIES) INCLUDING, 
 * WITHOUT LIMIATION, SALESFORCE.COM. COPY, USE OR DISTRIBUTION PROHIBITED WITHOUT EXPRESS 
 * WRITTEN CONSENT FROM COMPANY.
 -->
<apex:page id="pageId" standardController="Advanced_Routing__c" extensions="NewAdvancedRoutingController" sidebar="false">
	<apex:pageMessages id="pgmsgId"/>
	<apex:sectionHeader title="{!$Label.Advanced_Routing_Edit}" subtitle="{!$Label.New_Advanced_Routing}" rendered="{!AND(isFullLicenseAccessible, Advanced_Routing__c.Id == null)}"/>
	<apex:sectionHeader title="{!$Label.Advanced_Routing_Edit}" subtitle="{!Advanced_Routing__c.Name}" rendered="{!AND(isFullLicenseAccessible, Advanced_Routing__c.Id != null)}"/>
	<apex:pageMessage summary="{!$Label.User_License}" strength="3" severity="Info" rendered="{!NOT(isFullLicenseAccessible)}" />
	<style>
		.pbSubheader {
			background-image: none !important;
		}
    </style>
    
    <script>
   		var lookUpWindowOpen = false;
   		var popupflag = false;
   		var newWin = null;
   		
    	function openLookupWindow() {
    		if (!lookUpWindowOpen) {
    			lookUpWindowOpen = true;
    			popupflag = true;
    			var name = document.getElementById('pageId:formId:pageBlockId:pageBlockSectionId:' +
    												'pageBlockSectionItemId:clientRoutingVal1').value;
    			newWin = window.open(encodeURI('{!$Page.CustomLookup}?strText=' + name + '&obj=territory'), 'Popup', 'height=500, width=700, left=100, top=100, resizable=no, scrollbars=yes, toolbar=no, status=no');
    			lookUpWindowOpen = false;
    		}
    	}
    	
    	function closePopup(value, label) {
    		if (newWin != null) {
    			newWin.close();
    			if (typeof label != 'undefined') {
    				if (popupflag) {
    					document.getElementById('pageId:formId:pageBlockId:pageBlockSectionId:' +
    												'pageBlockSectionItemId:clientRoutingVal1').value = label;
						document.getElementById('pageId:formId:pageBlockId:pageBlockSectionId:' +
    												'pageBlockSectionItemId:clientRoutingVal2').value = value;
    					popupflag = false;
    				}
    			}
    		}
    	}
    </script>
	
	<apex:form id="formId" rendered="{!isFullLicenseAccessible}">
		<apex:pageBlock id="pageBlockId" title="{!$Label.Advanced_Routing_Edit}" mode="edit">
			
			<apex:pageBlockButtons >
				<apex:commandButton value="{!$Label.Save}" action="{!Save}"/>
				<apex:commandButton value="{!$Label.Cancel}" action="{!Cancel}"/>
			</apex:pageBlockButtons>
			
			<apex:pageBlockSection id="pageBlockSectionId" columns="1">
				<apex:inputField value="{!advRouting.Adv_Routing_Client_Value__c}" required="true" /> 
				<apex:inputField value="{!advRouting.Adv_Routing_Name__c}" />
				<apex:inputField value="{!advRouting.Adv_Routing_Attribute__c}" />
				
				<!-- Territory Lookup Field -->
                <apex:pageBlockSectionitem id="pageBlockSectionItemId" rendered="{!isTerritoryEnabled}">
                    <apex:outputLabel value="{!$ObjectType.Advanced_Routing__c.fields.Adv_Routing_Territory__c.label}"/>
                    <apex:outputPanel id="oprefAccId">
                        <apex:actionRegion >
                            <div style="float: left" class="requiredInput">
                           		<apex:inputText id="clientRoutingVal1" value="{!selectedTerritoryName}" style="margin-left: 0px; width: 170px" />
                           		<apex:inputText id="clientRoutingVal2" value="{!selectedTerritoryId}" style="display: none;" />
                           	</div>
                           	<div style="float: left">
                           		<apex:image url="{!$Resource.lookupIconImage}" styleClass="lookupIcon" onmouseover="this.className='lookupIconOn';" onmouseout="this.className='lookupIcon';" style="cursor: pointer" onclick="openLookupWindow()"/>
                           	</div>
                        </apex:actionRegion>
                    </apex:outputPanel>
                </apex:pageBlockSectionitem>
			</apex:pageBlockSection>
			
		</apex:pageBlock>
	</apex:form>
</apex:page>