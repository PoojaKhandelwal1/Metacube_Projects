<!--
 * ReferenceEdge
 * 
 * Point of Reference, Inc. - Copyright 2014 All rights reserved.
 *
 * @company : Point of Reference, Inc.
 * @website : www.point-of-reference.com
 *
 * Disclaimer: THIS SOFTWARE IS PROVIDED "AS-IS" BY POINT OF REFERENCE ("POR"), 
 * WITH NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF THE SOFTWARE, 
 * EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES 
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT. 
 * POR SHALL NOT BE LIABLE FOR ANY DAMAGES SUFFERED BY LICENSEE AS A RESULT OF USING, 
 * MODIFYING OR DISTRIBUTING THIS SOFTWARE OR ITS DERIVATIVES. POR IS NOT LIABLE FOR, 
 * AND MAKES NO REPRESENTATIONS OR WARRANTIES REGARDING, THE ACTIONS OR OMISSIONS OF 
 * ANY THIRD PARTIES (OR THE PRODUCTS OR SERVICES OFFERED BY ANY THIRD PARTIES) INCLUDING, 
 * WITHOUT LIMIATION, SALESFORCE.COM. COPY, USE OR DISTRIBUTION PROHIBITED WITHOUT EXPRESS 
 * WRITTEN CONSENT FROM COMPANY.
 -->
<apex:page controller="ReferenceRequestController" id="pageId" sidebar="false" tabStyle="Ref_Search__tab" action="{!userMappingRecord}">
    <!-- Add JavaScript & Jquery-->
    <c:POR_ModalLoader id="PORLoader"/>
    <!-- Add CSS-->
    <apex:stylesheet value="{!URLFOR($Resource.JqueryFiles, 'jquery-ui-1.9.2.custom.min.css')}"/>
     <apex:includeScript value="{!URLFOR($Resource.BootstrapFiles,'bootstrap.js')}"/>

    <style type="text/css">
        .helpText{ 
                    z-index: 1005 !important;
            }
        
            .pbSubheader{
                background-image : none !important;
                color: white  !important;
            }
            body .bPageBlock .pbBody .pbSubheader{
                color: white  !important;
            }
            .requiredLegend{
                color: white !important;
            }
        .datePicker{z-index : 9999;}  
        .ui-dialog-titlebar,.ui-widget-header {background-color:#79B4CD; border: 1px solid #79B4CD !important;}
        .locationError { color: blue; font-weight: strong;}
        
        /* Css override for make font consistent over  Request Detail modal - Re REF-1191   */
            .custom-modal .bPageBlock{
               background: none !important;
               border: none !important;
               background: #F8F8F8 !important;
               margin-bottom: 0;
            } 
            .custom-modal div#dialogBoxDiv {
              padding: 0 !important;
              height: auto !important;
            }
            .custom-modal .pbBottomButtons{
              border-top: 2px solid #DDDDDD;
              background: #EEEEEE !important;
            }
            .custom-modal .pbBottomButtons>table>tbody>tr>td{
              text-align: right;
            }
            .custom-modal .pbBody .labelCol{
              width: 30%;
            }
			body .bEditBlock .pbBottomButtons, body .apexp .bPageBlock.apexDefaultPageBlock .pbBottomButtons {
    			border-top: 1px solid #dddddd;
			}
			.ui-widget-header { 
			    color: #FFFFFF;
			    font-weight: bold;
			    font-size: 13.3px;
			    font-family: Arial;
			}	
			.bPageBlock .pbBottomButtons>table>tbody>tr>td {
    			padding: 5px 14px;
			}
			.ui-widget, .ui-widget input, .ui-widget select, .ui-widget textarea, .ui-widget button {
			    font-family: Arial;
			    font-size: 12px; 
			}
			.ui-dialog .ui-dialog-content {
			    position: relative;
			    border: 0;
			    padding: 0 !important;
			    background: none;
			    overflow: auto;
			    zoom: 1;
			    font-size: 12px;
			    font-family: Arial,Helvetica,sans-serif;
			    padding-top: 10px;
			}
			.bPageBlock .pbBottomButtons>table>tbody>tr>td {
    			padding: 9px 14px;
			}
             .helpTraining {
        position: relative;
        border-radius: .25rem;
        width: 13rem;
        min-height: 2rem;
        z-index: 60;        
       // display: inline-block;              
        font-family: "Salesforce Sans", Arial, sans-serif;
        color: #706e6b;
        display : none;
    }
        
    .arrowHelpTraining {
        background: #f1f3f3;
    }
    .arrowHelpTraining:after {
        bottom: 100%;
        left: 90%;
        border: solid transparent;
        content: " ";
        height: 0;
        width: 0;
        position: absolute;
        pointer-events: none;
        border-color: rgba(244, 246, 249, 0);
        border-bottom-color: #f1f3f3;
        border-width: 11px;
        margin-left: -12px;
        margin-top: -53px;
        }  
        .header {
            padding: 1.65rem;
            /*padding-left: 2.5rem;
            padding-top: 2.5rem;*/
            font-size: .8rem;   
            padding-bottom: 6px; 
        }
    
        .tour {
            padding: 0.5rem; 
            border-radius: 0;
            font-size: .8rem; 
        }
        .tour:hover{
        background-color : #E5F1EE;
            
        }
        
        .help {
            padding: 0.5rem; 
            border-radius: 0;
            font-size: .8rem;
            
        }
        .help:hover{
            background-color : #E5F1EE; 
        }
    
        #helpmessageId{
            position: relative; 
        } 
    </style>
    
    <script language="JavaScript" type="text/javascript">
        var clickedAccountId = '';
        var radioOptions = '';
        var noOfSelectedRecords = 0 ;
        var helpAssistant = '{!JSENCODE(helpAssistant)}';  
        //  REF-1532
        var globalHeaderHeight = 0;
        var counter = 0;
        var msg = '';
        var header = '';
        var content = '';
        var addcls = '';
        var removcls = '';
        var loc = '';
        var frmTop = '';
        var frmLft = '';
        var totlstps='5';

        if (jQuery('.globalHeaderBar')[0]) {
            globalHeaderHeight = jQuery("#AppBodyHeader").height() + jQuery("#globalHeaderBar").height();
        } else {            
            globalHeaderHeight = jQuery("#AppBodyHeader").height();
        }
        function rfSearchTour() {
            jQuery(".helpTraining").hide();
            /*  REF-1572
                objective : To show HelpOverlays
                modified By : Rajesh 29 May 2018
            */ 
            counter = 0; 
            msg = '';
            header = '';
            content = '';
            addcls = '';
            removcls = '';
            loc = '';
            frmTop = '';
            frmLft = ''; 
            ShowOrHideComponent(true); 
        }
        
        function onHoverToLink() {            
            var locationVar = jQuery('#helpmessageId');             
            jQuery("#helpAndTraining").css({top: locationVar.offset().top + 30 - globalHeaderHeight, left: locationVar.offset().left - 92, position:'absolute'});
            jQuery(".helpTraining").show();
        } 

        function ShowOrHideComponent(action) { 
            counter ++; 
			jQuery(window).scrollTop(0); 
           
			if (action) {   
               
				if (counter == 1) {  
					msg = helpAssistant + ' ' + '{!$Label.Requesting_a_Reference_Description}'; 
					header = '{!$Label.Requesting_a_Reference}'; 
					content = msg.replace('@@@', totlstps);
					addcls = '';
					removcls = 'arrow_compbox arrow_box_top arrow_box_top_right arrow_box_top_Corner';
					loc = 'AppBodyHeader'; 
					frmTop = 222 - globalHeaderHeight;
					frmLft = 475;
					
				} else if (counter == 2) {  
					header = '{!$Label.Item_Selection}'; 
					content = '{!$Label.Item_Selection_Description}';
					addcls = 'arrow_compbox';
					removcls = 'arrow_compbox arrow_box_top_Corner arrow_box_top_right';
					loc = 'spnSelect'; 
					frmTop = -40 - globalHeaderHeight;
					frmLft = '22';
					
				} else if (counter == 3) {  
					header = '{!$Label.Delete_Overlay}'; 
					content = '{!$Label.Delete_Description}';
					addcls = 'arrow_compbox';
					removcls = 'arrow_compbox arrow_box_top_Corner arrow_box_top_right';
					loc = 'divRecords'; 
					loc = 'divAction'; 
					frmTop = -14 - globalHeaderHeight;;
					frmLft = '23';
					
				} else if (counter == 4) {      
                    header = '{!$Label.Request_Details}'; 
                    content = '{!$Label.Request_Details_Description}';
					addcls = 'arrow_box_top_right';
					removcls = 'arrow_box_top arrow_box_top_right arrow_box_top_Corner';
					loc = 'refTypeReq'; 
					frmTop = 12 - globalHeaderHeight;
					frmLft = '-381'; 
					
				} else if (counter == 5) {  
					header = '{!$Label.Submit_Your_Request}';
					content = '{!$Label.Submit_Your_Request_Description}';
					addcls = 'arrow_box_top';
					removcls = 'arrow_compbox arrow_box_top_Corner arrow_box_top_right';
					loc = 'divBtn';  
					frmTop = 35 - globalHeaderHeight;;  
					frmLft = '23';
					
				} else {  
					action = false;   
			}
			} else {
				action = false;
			} 
			showHideHelpOverlays(action, header, content, loc, addcls, removcls, totlstps, frmTop, frmLft); 
		}

        var isMsgRender = false; 
        
        jQuery(document).ready(function(){
            var selectObj = document.getElementById('pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall');
            selectObj.checked = true;
            checkAll(selectObj, {!selectedAccounts.size});
            settingNoOfSelectedRecordsAndbg();  
            
            if ('{!showOveray}' == 'true') { 
                
                setTimeout(function(){ 
					rfSearchTour();  
					}, 2000);
                //rfSearchTour();
            } 
        });
        
        function openModal(accId, clickedEleId,refDays,requestRecordsSize){
            var editedId = clickedEleId.substring(0, clickedEleId.length-1);
            //document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:refNeededId:selectRefType').value = document.getElementById(editedId+'1').innerHTML;
            if(document.getElementById(editedId+'2').innerHTML != '')
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value = (document.getElementById(editedId+'2').innerHTML != 'Click here' ? document.getElementById(editedId+'2').childNodes[0].innerHTML : '');//document.getElementById(editedId+'2').childNodes[0].innerHTML;
            else 
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value = ''; 
                   
            if(document.getElementById(editedId+'3').innerHTML != '')
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:reqNotesId').value = document.getElementById(editedId+'3').childNodes[0].innerHTML;
            else
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:reqNotesId').value = '';
            if(requestRecordsSize == 1){
                noOfSelectedRecords = 1;
            }
            var ele = document.getElementById("pageId:fromId:reqRefUsepbId:modalPbId:radioPbsId:selectedRadioId:1");
            jQuery("label[for='pageId:fromId:reqRefUsepbId:modalPbId:radioPbsId:selectedRadioId:1']").text("All "+ noOfSelectedRecords +" Selected Records") ;
            
            var firstRadioEle = document.getElementById("pageId:fromId:reqRefUsepbId:modalPbId:radioPbsId:selectedRadioId:0");
            jQuery(firstRadioEle).attr('checked', true);
            
            clickedAccountId = accId;
            
            // calculating element id of checkbox of record clicked
            var len = clickedEleId.length - 4 ;
            var subStr = clickedEleId.substring(0, len)+'singleselect';
            var chkbox = document.getElementById(subStr);
            if(requestRecordsSize > 1){
                if(noOfSelectedRecords != 0 && chkbox.checked) {
                    
                    jQuery("#dialogBoxDiv").dialog({
                        height    : 275,
                        width     : 600,
                        modal     : true,
                        resizable : false,                 
                    });
                    
                }else {
                    alert('{!$Label.select_this_record}');
                    return false;
                }
            }
            else {
                jQuery("#dialogBoxDiv").dialog({
                    height    : 275,
                    width     : 600,
                    modal     : true,
                    resizable : false,                 
                });
                var secondRadioElement = document.getElementById("pageId:fromId:reqRefUsepbId:modalPbId:radioPbsId:selectedRadioId:1");
                jQuery(secondRadioElement).attr('disabled', true);
                jQuery('input[type="checkbox"]').each(function() {
                    this.checked=true;
                });
            }
            var id = 'pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId' ;
            var ele = document.getElementById(id) ;
            
            jQuery(ele).removeAttr('onfocus');
            
            jQuery(ele).click(function() {
                DatePicker.pickDate(true, 'pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId', false);
                jQuery('.datePicker').removeAttr('style');
                var l = Math.ceil((jQuery(ele).offset()).left) - 10;
                var r = Math.ceil((jQuery(ele).offset()).top) - 90;
                jQuery('.datePicker').css('display','block').css('left',l+'px').css('top',r+'px');
            });
            
            var errId = 'pageId:fromId:reqRefUsepbId:modalPbId:pmsg' ;
            var errEle = document.getElementById(errId);
            var defaultDate = '{!JSENCODE(defaultDate)}';
            if(document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value == ''){
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value = defaultDate;
            }
            var deadlineMsg = '{!$Label.Min_deadline_days}';
            document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:minDeadline').innerHTML = deadlineMsg.replace('@@@', refDays);
            jQuery(errEle).hide();
        } 
        
        function closeModal(source){
            if((!isMsgRender && source=="save") || (source=="cancel") ) {
                jQuery("#dialogBoxDiv").dialog( "close" );
                jQuery('input[type="checkbox"]:checked').each(function() {
                    if(this.id != 'pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall') {
                      setBackground(true, this);
                 }
                });
                jQuery("#dialogBoxDiv").dialog( "destroy" );
            }
            
            if(isMsgRender && source=="save") {
                jQuery('input[type="checkbox"]:checked').each(function() {
                    if(this.id != 'pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall') {
                        setBackground(true, this);
                    }
                });
                jQuery("#dialogBoxDiv").css('height',390);
            }
        }
        
        function massUpdateAccounts(){
            var referenceUseNeeded = document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:refNeededId:selectRefType').value;
            var deadline = document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value;
            var referenceNotes = document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:reqNotesId').value;
            var radioSelect = 'All Selected Records';
            /*
            for(i = 0; i < radioOptions.length; i++) 
            if(radioOptions [i].checked) {
                radioSelect = radioOptions[i].value;
            }
            */
            updateAccounts(referenceUseNeeded, deadline, referenceNotes, clickedAccountId, radioSelect);
        }
        
        //this method is Use for Checked for all Chekboxes
        function checkAll(cb, size){            
            for(var i=0; i < size; i++) {
                var id = "pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:"+ i +":singleselect"; // generating key for each checkbox
                document.getElementById(id).checked = cb.checked;
                
                var ele = document.getElementById(id) ;
                setBackground(cb.checked, ele);
            }
            if(cb.checked) {
                noOfSelectedRecords = size;
            } else {
                noOfSelectedRecords = 0 ;
            }
        }
        
        //this method is called on click of checkbox if all check boxes are selected than selectAll checkbox will be checked
        function selectOrDeselectAll(cb, size) {
            var selectAllid = document.getElementById("pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall");
            //if select all checkbox is chechked 
            if(document.getElementById("pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall").checked) {
                
                document.getElementById("pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall").checked = cb.checked;
            } else {
                var isAllselect = true;
                for(var i=0; i < size; i++) {
                    var id = "pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:"+i+":singleselect"; // generating key for each checkbox
                    /* if atlealst one checkbox is not checked */
                    if(!document.getElementById(id).checked ) {
                        isAllselect = false ;
                        break ;  //loop will break if atlest one check box is not checked 
                    }
                }
                if(isAllselect) {
                    document.getElementById("pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall").checked = true;
                }
            }
            var CheckedOrUnchecked = cb.checked ;     
            setBackground(CheckedOrUnchecked, cb);
            
            if(cb.checked) {
                noOfSelectedRecords ++;
            } else {
                noOfSelectedRecords -- ;
            }
        }
        
       function validateSelection(size){
            var hasChecked = false;
            for(var i=0; i < size; i++) {
                var id = "pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:"+i+":singleselect"; 
                if(document.getElementById(id).checked ) {
                    hasChecked = true;
                    break ;  
                }
            }
            if (hasChecked == false){
                alert('{!$Label.Select_atleast_one_account_from_Request_Details}');
                return false;
            }
            
            PORShowLoading();
            
            var ids2 ='' ;
            for(var i=0; i < size; i++) {
                var id = "pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:"+i+":singleselect"; 
                var id2 = "pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:"+i+":selectsingleHidden";
                if(document.getElementById(id).checked ) {
                    if(ids2 == '') {
                        ids2 = document.getElementById(id2).value ;
                    } else {
                        ids2 = ids2+','+document.getElementById(id2).value ;
                    }
                }
            }            
            bind(ids2);
        }

        
        function setBackground(CheckedOrUnchecked, ele) {
            /*if(CheckedOrUnchecked == true) {
                ele.closest('tr').css("background-color","#B0E1FA");
            }else {
                ele.closest('tr').css("background-color","#FFFFFF");
            }*/
            
            if(CheckedOrUnchecked == true) {
                ele.closest('tr').children[4].style.backgroundColor = '#e3f3ff';
                if(ele.closest('tr').children[5].innerHTML == '')
                    ele.closest('tr').children[5].innerHTML = 'Click here';
                ele.closest('tr').children[5].style.backgroundColor = '#e3f3ff';
            }else {
                ele.closest('tr').children[4].style.backgroundColor = '#FFFFFF';
                ele.closest('tr').children[5].style.backgroundColor = '#FFFFFF';
                if(ele.closest('tr').children[5].innerHTML == 'Click here')
                    ele.closest('tr').children[5].innerHTML = '';
            }
        } 
        
        function settingNoOfSelectedRecordsAndbg() {
            noOfSelectedRecords = 0 ;
            jQuery('input[type="checkbox"]:checked').each(function() { 
                if(this.id != 'pageId:fromId:reqRefUsepbId:reqDetailId:pbtAccount:selectall') {
                    noOfSelectedRecords ++ ;
                    setBackground(true, this);
                }
            });
        }
        
    </script>
    <apex:outputPanel id="resetDeadLine">
        <script>
            function setDeadline(){
                document.getElementById('pageId:fromId:reqRefUsepbId:modalPbId:modalPbbId:deadlineId:selectDeadlineId').value = '{!JSENCODE(refDeadline)}';
            }
        </script>
    </apex:outputPanel>
   
    <!-- Messages -->
    <apex:pageMessages id="pgmsgId"/>
     <!--   To show / Hide walkThrough for the page    -->  
     <c:HelpOverlays />   
    <!--  To show / Hide walkThrough for the page    ---   END     --- -->  
    <!-- Form -->
    <apex:form id="fromId">
        <apex:outputPanel rendered="{!!isSubmitted}">
            <div id="helpmessageId" style="cursor: pointer; float:right" onmouseover="onHoverToLink()">
                <span class="helpLink">{!$label.Help_for_this_page}</span>
                <img src="/img/s.gif" alt="" class="helpIcon" title=""/>
            </div>
        </apex:outputPanel>
        <apex:actionFunction name="bind"  action="{!submitRequest}" oncomplete="PORHideLoading();" reRender="pgmsgId, fromId">
            <apex:param name="one" value="" assignTo="{!selectedIds}"/>
        </apex:actionFunction>  

        <!-- Action Fuctions  -->     
        <apex:actionFunction name="updateAccounts" action="{!selectAndUpdate}" oncomplete="closeModal('save');" reRender="reqDetailId,pmsg">
            <apex:param name="p1" assignTo="{!param1}" value="" />
            <apex:param name="p2" assignTo="{!param2}" value="" />
            <apex:param name="p3" assignTo="{!param3}" value="" />
            <apex:param name="p4" assignTo="{!param4}" value="" />
            <apex:param name="p5" assignTo="{!selectedValue}" value="" />
        </apex:actionFunction>
        
        <apex:actionFunction name="removeAccountFromList" action="{!removeAccountFromList}" oncomplete="settingNoOfSelectedRecordsAndbg();" reRender="pgmsgId, reqRefUsepbId" >
            <apex:param name="accountToRemove" value="" assignTo="{!accountIdToRemoveFromList}" />
        </apex:actionFunction>
        
        <apex:actionFunction name="changeMinimumDeadline" action="{!changeMinimumDeadline}" onComplete="setDeadline();"  reRender="resetDeadLine,minDeadline" status="status">
            <apex:param name="param" assignTo="{!referenceType}" value=""/>
        </apex:actionFunction>
        
        <!-- Page  Block-->
        <apex:pageBlock id="submittedId"  rendered="{!isSubmitted}">
            <apex:pageMessage summary="{!$Label.Request_submitted}" severity="INFO" strength="3" /> 
            <apex:commandButton value="{!$Label.Back_to_Opportunity}" action="{!returnOpportunity}" rendered="{!NOT(ISBLANK(opportunityId))}"/>  
            <apex:commandButton value="{!$Label.Back_to_Case}" action="{!returnOpportunity}" rendered="{!NOT(ISBLANK(caseId))}"/> 
            <!-- regarding ticket #809 -->
            <apex:commandButton value="{!$Label.Back_to_SearchLead}" action="{!returnOpportunity}" rendered="{!NOT(ISBLANK(leadId))}"/>
            <apex:commandButton value="{!$Label.Back_to_RF_Search}" action="{!returnOpportunity}" rendered="{!AND(ISBLANK(opportunityId),ISBLANK(caseId),ISBLANK(leadId))}"/> 
        </apex:pageBlock>
        
        <!-- Page  Block-->
        <apex:pageBlock title="{!$Label.Request_Reference_Use}" id="reqRefUsepbId"  mode="Edit" rendered="{!NOT(isSubmitted)}">
            <!-- Opportunity Details Page  Block Section-->
            <apex:pageBlockSection title="{!$Label.Opportunity_Information}" id="opInfopbsId" rendered="{!NOT(ISBLANK(opportunityId))}"> 
                <apex:outputField value="{!opportunity.AccountId}" label="{!$Label.Opportunity_Account}"/>
                
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.Opportunity_Name}" for="oppName"/>
                    <apex:outputLink value="/{!opportunity.Id}" id="oppName">
                        <apex:outputText value="{!opportunity.Name}"/>
                    </apex:outputLink>
                </apex:pageBlockSectionItem>               
            </apex:pageBlockSection>
            <!-- Case Details Page  Block Section-->
            <apex:pageBlockSection title="{!$Label.Case_Information}" id="caseInfopbsId" rendered="{!IF(ISBLANK(caseId), false,true)}">
                <apex:outputField value="{!caseObj.AccountId}" label="{!$Label.Case_Account}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$ObjectType.Case.fields.CaseNumber.Label}" for="caseNo"/>
                    <apex:outputLink value="/{!caseObj.Id}" id="caseNo">
                        <apex:outputText value="{!caseObj.CaseNumber}"/>
                    </apex:outputLink>
                </apex:pageBlockSectionItem>               
            </apex:pageBlockSection>
            <!-- Lead Details Page  Block Section regarding ticket #809-->
            <apex:pageBlockSection title="{!$Label.Lead_Information}" id="leadInfopbsId" rendered="{!IF(ISBLANK(leadId), false,true)}">
                <apex:outputField value="{!leadObj.Company}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="{!$Label.Lead_Name}" for="leadName"/>
                    <apex:outputLink value="/{!leadObj.Id}" id="leadName">
                        <apex:outputText value="{!leadObj.Name}"/>
                    </apex:outputLink>
                </apex:pageBlockSectionItem>              
            </apex:pageBlockSection>
            <!-- Account & Request Details Page  Block Section-->
             <div id="divRecords"></div>  
            <apex:pageBlockSection title="{!$Label.Request_Details}" id="reqDetailId"  columns="1"> 
                <Script>
                    isMsgRender = {!isMessageRender} ;
                </Script>
                <apex:outputPanel rendered="{!selectedAccounts.size > 0}">
                    <apex:pageBlockTable value="{!selectedAccounts}" var="selAccWrap" id="pbtAccount">
                        <apex:column id="headerFooterId">
                            <!-- Header-->
                            <div id="spnSelect">
                                <apex:facet name="header">
                                    <apex:inputCheckBox id="selectall" onclick="checkAll(this, {!selectedAccounts.size})"/>
                                </apex:facet>
                            </div>
                            <!-- Inner Check Boxes with Records-->
                            <apex:inputCheckBox id="singleselect" value="{!selAccWrap.isSelected}" onclick="selectOrDeselectAll(this, {!selectedAccounts.size})"/>
                            <apex:inputhidden value="{!selAccWrap.acc.Account__r.Id}" id="selectsingleHidden"/>
                        </apex:column> 
                        
                        <apex:column headerValue="{!$Label.Action}" >
                            <div id ="divAction">
                                <apex:commandLink value="{!$Label.Delete}" onclick="removeAccountFromList('{!JSENCODE(selAccWrap.acc.Account__r.id)}'); return false;"/>
                            </div>
                        </apex:column>
                                          
                        <apex:column headerValue="{!$Label.Account_Requested}" value="{!selAccWrap.acc.Account__r.name}"/>
                        <apex:column headervalue="{!$Label.Owner}" > 
                            <apex:outputField value="{!selAccWrap.acc.Reference_Owner__c}" rendered="{!IF(selAccWrap.acc.Reference_Owner__c != NULL, true, false)}"/>
                            <apex:outputField value="{!selAccWrap.acc.Account__r.OwnerId}" rendered="{!IF(selAccWrap.acc.Reference_Owner__c == NULL, true, false)}"/>
                        </apex:column>
                        <apex:column style="{!IF(AND(isDeadlineRefBlank,selAccWrap.refRequestAccount.Reference_Type_Needed__c == null), 'width:200px;background-color: rgb(250, 176, 176) !important;','width:200px;')}" value="{!selAccWrap.refRequestAccount.Reference_Type_Needed__c}" id="prm1" onclick="openModal('{!JSENCODE(selAccWrap.acc.Account__r.id)}', '{!JSENCODE($Component.prm1)}',{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size},{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size});">
                            <apex:facet name="header"><div class="requiredInput"><div id="refTypeReq"  class="requiredBlock"></div>{!$Label.Reference_Type_Needed}</div></apex:facet>
                        </apex:column>
                         
                        <apex:column style="{!IF(AND(isDeadlineRefBlank,selAccWrap.refRequestAccount.Deadline__c == null), 'width:200px;background-color: rgb(250, 176, 176) !important;','width:200px;')}" value="{!selAccWrap.refRequestAccount.Deadline__c}" id="prm2" onclick="openModal('{!JSENCODE(selAccWrap.acc.Account__r.id)}', '{!JSENCODE($Component.prm2)}',{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size},{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size});">
                            <apex:facet name="header"><div class="requiredInput"><div class="requiredBlock"></div>{!$Label.Deadline}</div></apex:facet>
                        </apex:column>
                        <apex:column headervalue="{!$Label.Request_Notes}" value="{!selAccWrap.refRequestAccount.Request_Notes__c}" id="prm3" onclick="openModal('{!JSENCODE(selAccWrap.acc.Account__r.id)}','{!JSENCODE($Component.prm3)}',{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size},{!JSENCODE(refTypeDeadlineMap[selAccWrap.refRequestAccount.Reference_Type_Needed__c])}, {!selectedAccounts.size});"/>
                    </apex:pageBlockTable>
                </apex:outputPanel>
                <apex:outputPanel rendered="{!NOT(selectedAccounts.size > 0)}">
                    <apex:pageMessage summary="{!$Label.Reference_Request_select_account}" strength="3" severity="Info"/>
                </apex:outputPanel>
            </apex:pageBlockSection>
            
            
            <!-- Command Buttons Page Block Section-->
            <div id="divBtn">
                <apex:pageBlockButtons id="refReqPpbId">
                    <div id="divBtn">
                        <apex:commandButton value="{!$Label.Submit_Request}"  onclick="validateSelection(parseInt({!selectedAccounts.size})); return false;"/>
                        <apex:commandButton value="{!$Label.Cancel}" action="{!redirectToSearchPage}" onclick="PORShowLoading();" />
                    </div>
                 </apex:pageBlockButtons>
            </div>
            <!-- Div of Modal box-->
            <div id="dialogBoxDiv" title="{!$Label.Edit}" class="custom-modal" style="display:none;height: 235px !important;">
                <div class = "waitingSearchDiv" id = "el_loading" style="display:none;"> 
                    <div class = "waitingHolder">
                        <img class = "waitingImage" src = "/img/loading32.gif" title = "{!$Label.Please_Wait}" />
                        <span class = "waitingDescription">{!$Label.Loading}</span>
                    </div>
                </div> 
                <apex:pageBlock id="modalPbId">
                    <apex:pageMessages id="pmsg"/>
                    
                    <apex:pageBlockSection columns="1" id="modalPbbId">
                            
                        <apex:pageBlockSectionItem id="refNeededId">
                            <apex:outputLabel value="{!$Label.Reference_Type_Needed}" />
                            <apex:outputPanel styleClass="requiredInput" layout="block" >
                            <div class="requiredBlock"></div>
                                <apex:selectList size="1" value="{!refRequestAccount.Reference_Type_Needed__c}" onChange="changeMinimumDeadline(this.value);" id="selectRefType" style="width:250px">
                                    <apex:selectOptions value="{!referenceabilityTypes}"/>
                                </apex:selectList>
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        
                        
                        <apex:pageBlockSectionItem id="deadlineId">
                            <apex:outputLabel value="{!$Label.Deadline}" />
                            <apex:outputPanel styleClass="requiredInput" layout="block" >
                             
                            <div class="requiredBlock"></div>
                                <apex:inputField value="{!refRequestAccount.Deadline__c}" id="selectDeadlineId" onfocus="calen(); return false;"/>   
                                <apex:outputLabel id="minDeadline" value="{!minDeadlineLabel}" /> 
                            </apex:outputPanel>
                        </apex:pageBlockSectionItem>
                        
                        <apex:inputField value="{!refRequestAccount.Request_Notes__c}" id="reqNotesId"  style="width: 257px;height: 89px;"/>
                        
                    </apex:pageBlockSection>
                    <!-- 
                    <apex:pageBlockSection columns="1" id="radioPbsId">
                        <apex:selectRadio id="selectedRadioId" layout="pagedirection" label="{!$Label.Apply_changes_to}" value="{!selectedValue}">
                            <apex:selectOption itemValue="The Record Clicked" itemLabel="{!$Label.The_Record_Clicked}" />
                            <apex:selectOption itemValue="All Selected Records" itemLabel="{!$Label.All_Selected_Records}"/>
                        </apex:selectRadio>
                        <script>
                            radioOptions = document.getElementsByName('{!JSENCODE($Component.selectedRadioId)}');
                        </script>
                    </apex:pageBlockSection>
                     -->
                    <apex:pageBlockButtons location="bottom">
                        <apex:commandButton value="{!$Label.Save}" onclick="massUpdateAccounts();return false;" />
                        <apex:commandButton value="{!$Label.Cancel}" onclick="closeModal('cancel');return false;" />
                    </apex:pageBlockButtons> 
                    <apex:actionstatus id="status" >
                    <apex:facet name="start" >
                        <div class = "waitingSearchDiv" id = "el_loading" > 
                            <div class = "waitingHolder" >
                                <img class = "waitingImage" src="{!$Resource.LoaderSpinner}" width="60" height="60"/>
                            </div>
                        </div>
                    </apex:facet>
                </apex:actionstatus>              
                </apex:pageBlock>
                  
            </div> 
        </apex:pageBlock> 
    </apex:form>  
    <!--   
       
        objective : To show HelpOverlays
        modified By : Rajesh
         -->

    <div id="helpAndTraining" rel="helpTraining_popup" class="helpTraining arrowHelpTraining">
        <div class ="header">
            {!$Label.Help_and_trainning}
        </div>
        <div class="tour" onclick="rfSearchTour()" style="cursor: pointer; padding-left: 10px;padding-bottom: 15px;">
            <div style="float:left"><apex:image value="{!URLFOR($Resource.helpOverlayIcon,'/myIcons/plybtn3.png')}" style="width : 24px; height : 21px;"/>&nbsp;&nbsp;</div><div style="padding-top:6px">
                Request Tour
            </div>
        </div> 
    </div>
     <style>
        .textStyle{
            font-family: arial,sans-serif;
            font-size: 120%;
        }
        .overlay {
            position: relative;
            border-radius: .25rem;
            width: 22rem !important;
            min-height: 2rem;
            z-index: 6000;
            border-color: rgb(6, 28, 63);
            display: none;
            box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.16);
            font-family: 'Salesforce Sans',Arial,sans-serif;
            line-height: 1.5;
            background: rgba(176, 196, 223, 1.0);
            color: rgb(62, 62, 60);
            font-size: 13px;
        }
         .overlay_Header-cls {
            background-color: rgb(33, 67, 112);
            padding: 1rem !important;
            text-shadow: 0 0 4px rgb(3, 46, 97);
            color: white;
            height: 20px !important;
            border-top-right-radius: 3px !important;
            border-top-left-radius: 3px !important;
            font-family: 'Salesforce Sans',Arial,sans-serif;
            font-size: 15px;
        }

        .overlay_body-cls {
            padding-top:3px;
        }
        .btn-next { 
            width: 23px;
        }
    </style>
</apex:page>